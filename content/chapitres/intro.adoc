[{invert}]

= Docker

"La Base"

== Pourquoi ?

image::docker-logo-monochromatic.png[width=200]

ü§î Quel est le probl√®me ?

[%auto-animate]
== Pourquoi commencer par un probl√®me ?

image::docker-logo-monochromatic.png[width=200]

ü§î Commen√ßons plut√¥t par une d√©finition:

> Docker c'est ...

[.notes]
--
* Demander √† l'assistance une d√©finition
--

[%auto-animate]
== Pourquoi commencer par un probl√®me ?

image::docker-logo-monochromatic.png[width=200]

ü§î D√©finition quelque peu dat√©e (2014):

> Docker is ...

[.notes]
--
* Demander √† l'assistance une d√©finition
* make a point
--

[%auto-animate]
== Pourquoi commencer par un probl√®me ?

image::docker-logo-monochromatic.png[width=200]

ü§î D√©finition quelque peu dat√©e (2014):

> Docker is a toolset for Linux containers designed to ‚Äòbuild, ship and run‚Äô distributed applications.

[.small]
https://www.infoq.com/articles/docker-future/

[.notes]
--
* https://www.infoq.com/articles/docker-future/
--

[%auto-animate]
== Linux containers ?

image::docker-logo-monochromatic.png[width=200]

ü§î Nous voil√† bien...

> C'est quoi un container?

[.notes]
--
* https://www.infoq.com/articles/docker-future/
--

[%auto-animate]
== Linux containers ?

image::docker-logo-monochromatic.png[width=200]

ü§î Nous voil√† bien...

> C'est quoi un container?

[.small]
Vous voulez la version enfant de 5 ans? Je ne crois pas...

[.notes]
--
* J'ai la version "les containers expliqu√©s √† un enfant de 5 ans", mais pas s√ªr que vous appr√©ciez...
* On va donc passer √† la suite, et on y revient dans un moment.
* Imagine que tu as une bo√Æte magique appel√©e "conteneur".
* Cette bo√Æte peut contenir toutes sortes de choses, comme des jouets, des bonbons ou m√™me des dessins.
* Maintenant, dans le monde de l'informatique, un conteneur Docker est un peu comme cette bo√Æte magique.
* Mais au lieu de jouets ou de bonbons, un conteneur Docker peut contenir des programmes et toutes les choses dont ces programmes ont besoin pour fonctionner.
* Par exemple, il peut contenir un site Web, une application ou m√™me une partie d'un jeu vid√©o.
* Ce qui est vraiment cool avec les conteneurs Docker, c'est qu'ils sont tr√®s sp√©ciaux.
* Chaque conteneur est comme une petite bo√Æte magique qui garde tout bien organis√© √† l'int√©rieur.
* Et tu peux facilement prendre cette bo√Æte magique et la mettre sur n'importe quel ordinateur, qu'il soit grand ou petit, comme si tu transportais tes jouets pr√©f√©r√©s chez un ami.
* Cela signifie que les conteneurs Docker aident les d√©veloppeurs √† s'assurer que leurs programmes fonctionnent de la m√™me mani√®re partout o√π ils les utilisent. C'est comme si tu pouvais t'amuser avec tes jouets pr√©f√©r√©s chez toi, chez un ami, ou m√™me √† l'√©cole, et tout fonctionnerait toujours comme pr√©vu.
* En r√©sum√©, un conteneur Docker est comme une bo√Æte magique pour les programmes informatiques.
* Il garde tout bien organis√© √† l'int√©rieur et peut √™tre d√©plac√© facilement d'un ordinateur √† un autre, comme si tu emportais tes jouets pr√©f√©r√©s partout o√π tu vas. C'est super pratique pour les personnes qui cr√©ent des choses sur l'ordinateur !
--

[{invert}]
[.columns]
== Docker est vieux

[.column]
--
image::containerconteneuraccidenteavariejpg_5e8b87ccc8c27.jpg[position=left, opacity=0.1]
--

[.column]
--
10 ans d√©j√†...

image::piWorkshop.png[position=left, opacity=0.1]

* parler de mes d√©buts en 2015/2016
* parler de balena

--

[.notes]
--
* The story of Docker starts in Paris with a startup called DotCloud, founded by Solomon Hykes, Kamel Founadi,
and Sebastien Pahl in 2008 to provide cloud hosting services for software developers.
* It was first released as an open source project by DotCloud in March 2013.
* The project quickly became popular, leading to DotCloud rebranded as Docker Inc
--

== On n'avait pas parl√© d'un probl√®me?

image::matrixfromhell.jpg[]

Probl√®me de temps **exponentiel**

[.notes]
--
* Le "probl√®me de la matrice de l'enfer" (ou "matrix from hell" en anglais) est une expression qui fait r√©f√©rence √† la complexit√© croissante des configurations logicielles dans le monde de l'informatique.
* Avant l'arriv√©e de Docker, il √©tait souvent difficile de g√©rer toutes les d√©pendances et les param√®tres n√©cessaires pour ex√©cuter des applications sur diff√©rents ordinateurs.
* Docker tente de r√©soudre ce probl√®me en introduisant la notion de conteneurs.
* Les conteneurs Docker sont des environnements autonomes qui contiennent une application et toutes ses d√©pendances, y compris les biblioth√®ques et les param√®tres. Cela signifie que les d√©veloppeurs peuvent cr√©er un conteneur qui fonctionne parfaitement sur leur propre ordinateur, puis le partager avec d'autres sans se soucier des diff√©rences entre les environnements.
* En r√©sum√©, Docker r√©sout le "probl√®me de la matrice de l'enfer" en permettant aux d√©veloppeurs de cr√©er des conteneurs contenant leurs applications, ce qui garantit que celles-ci fonctionneront de la m√™me mani√®re partout, √©vitant ainsi les tracas li√©s aux configurations complexes.
--

== D√©j√† vu ?

L'IT n'est pas la seule industrie √† r√©soudre des probl√®mes...

image::also-a-matrix-from-hell.png[]

== Solution: Le conteneur intermodal

"Separation of Concerns"

image::blue-shipping-container.png[]

[.notes]
--
Faire le parall√®le avec les containers marchands contenant des jouets, de l'√©lectronique, de la nourriture, le tout connect√© au m√™me bateau, sans pour autant √™tre interd√©pendants.
Docker apporte une s√©paration claire des pr√©occupations gr√¢ce √† ses conteneurs. Cette s√©paration des pr√©occupations signifie que chaque composant d'une application est isol√© dans son propre conteneur. Voici comment cela fonctionne :

1. Isolation des Composants : Avec Docker, chaque composant d'une application (comme une base de donn√©es, un serveur web, etc.) est emball√© dans un conteneur distinct. Ces conteneurs fonctionnent de mani√®re ind√©pendante les uns des autres, ce qui signifie que si un composant rencontre un probl√®me ou n√©cessite une mise √† jour, cela n'affecte pas les autres composants.
2. Portabilit√© : Les conteneurs Docker encapsulent non seulement l'application, mais aussi toutes ses d√©pendances. Cela garantit que l'application fonctionnera de la m√™me mani√®re quel que soit l'endroit o√π vous l'ex√©cutez, que ce soit sur votre ordinateur local, un serveur en nuage ou ailleurs. Cela simplifie la gestion de l'application √† l'√©chelle.
3. Facilit√© de D√©ploiement : En raison de cette s√©paration, le d√©ploiement d'applications devient plus simple. Vous pouvez g√©rer chaque conteneur individuellement, les mettre √† jour sans perturber le reste de l'application, et m√™me les r√©pliquer pour mettre en place des configurations complexes.
4. Gestion des Ressources : Docker permet √©galement de g√©rer efficacement les ressources de l'ordinateur h√¥te. Chaque conteneur a sa propre allocation de ressources, ce qui emp√™che un conteneur de monopoliser toute la puissance de calcul, garantissant ainsi des performances stables pour toutes les parties de l'application.

En r√©sum√©, Docker apporte une s√©paration des pr√©occupations claire en isolant chaque composant d'une application dans son propre conteneur. Cela facilite le d√©ploiement, la gestion et la maintenance des applications, tout en garantissant la portabilit√© et la stabilit√© des performances.
--

[%auto-animate]
== Comment √ßa marche ?

"Virtualisation **L√©g√®re**"

image::container_vs_vm.jpg[]

[.notes]
--
La virtualisation l√©g√®re, dans le contexte des conteneurs Docker, est une m√©thode de virtualisation qui permet d'ex√©cuter plusieurs environnements isol√©s (conteneurs) sur un seul syst√®me d'exploitation (h√¥te). Contrairement √† la virtualisation traditionnelle, o√π chaque machine virtuelle (VM) n√©cessite son propre syst√®me d'exploitation, les conteneurs partagent le m√™me noyau du syst√®me d'exploitation de l'h√¥te.

Les principales caract√©ristiques de la virtualisation l√©g√®re sont les suivantes :

1. Isolation : Chaque conteneur est isol√© des autres, ce qui signifie qu'ils ne peuvent pas interf√©rer les uns avec les autres. Cela permet d'ex√©cuter diff√©rentes applications avec leurs propres d√©pendances sans conflits.
2. Efficacit√© des ressources : √âtant donn√© que les conteneurs partagent le m√™me noyau du syst√®me d'exploitation, ils sont beaucoup plus l√©gers en termes de ressources que les machines virtuelles. Cela permet d'ex√©cuter de nombreux conteneurs sur une seule machine physique, ce qui est efficace en termes d'utilisation des ressources.
3. D√©marrage rapide : Les conteneurs se lancent rapidement, en quelques secondes, car ils n'ont pas besoin de d√©marrer un syst√®me d'exploitation complet. Cela permet une mise √† l'√©chelle rapide des applications.
4. Portabilit√© : Les conteneurs sont portables, ce qui signifie qu'ils fonctionnent de la m√™me mani√®re sur n'importe quel syst√®me qui prend en charge Docker. Cela simplifie le d√©ploiement et la gestion des applications.

En r√©sum√©, la virtualisation l√©g√®re des conteneurs Docker permet d'ex√©cuter efficacement plusieurs environnements isol√©s sur un m√™me syst√®me d'exploitation, offrant ainsi une isolation, une efficacit√© des ressources, un d√©marrage rapide et une portabilit√© des applications.
--

[%auto-animate]
== Comment √ßa marche ?

Virtualisation

image::types_of_hypervisors.png["https://medium.com/teamresellerclub/type-1-and-type-2-hypervisors-what-makes-them-different-6a1755d6ae2c"]

[.notes]
--
Un hyperviseur est un logiciel sp√©cialis√© qui permet d'ex√©cuter plusieurs syst√®mes d'exploitation (comme Windows, Linux, etc.) sur un seul mat√©riel physique (comme un serveur). Il agit comme une couche d'abstraction entre le mat√©riel et les syst√®mes d'exploitation invit√©s.

Il existe deux types d'hyperviseurs :

Hyperviseurs de type 1 (ou bare-metal) : Ils s'installent directement sur le mat√©riel physique et n'ont pas besoin d'un syst√®me d'exploitation h√¥te. Ils sont tr√®s efficaces et sont g√©n√©ralement utilis√©s dans les centres de donn√©es pour ex√©cuter plusieurs VM de mani√®re isol√©e.

Hyperviseurs de type 2 (ou hosted) : Ils s'ex√©cutent sur un syst√®me d'exploitation existant, comme une application. Ils sont g√©n√©ralement utilis√©s pour la virtualisation de bureau ou le d√©veloppement, mais sont moins efficaces que les hyperviseurs de type 1.

En r√©sum√©, un hyperviseur vous permet d'ex√©cuter plusieurs syst√®mes d'exploitation sur un seul serveur physique, ce qui vous permet de maximiser l'utilisation des ressources mat√©rielles et de simplifier la gestion des environnements informatiques.
--

[%auto-animate]
[.columns]
== Comment √ßa marche ?

[.column]
Virtualisation

[.column]
---
image::type-1-hypervisor-examples.png["https://www.ubackup.com/enterprise-backup/type-1-hypervisor-vs-type-2.html"]
--

[.column]
---
image::type-2-hypervisor-examples.png["https://www.ubackup.com/enterprise-backup/type-1-hypervisor-vs-type-2.html"]
--

[%auto-animate]
== Comment √ßa marche ?

"Virtualisation **L√©g√®re**"

image::container_vs_vm.jpg[]

* L√©g√®re, vraiment?

[%auto-animate]
== L√©g√®re, vraiment!

image::RPiDockerConChallenge.png[background, size=contain, position=left, opacity=0.1]

[.small]
http://web.archive.org/web/20200810061020/https://www.docker.com/blog/raspberry-pi-dockercon-challenge-winner/


[%auto-animate]
== L√©g√®re, vraiment!

image::esxpi.png[background, size=contain, position=left, opacity=0.1]

[.small]
https://www.architecting.it/blog/esxi-on-raspberry-pi/

== Conteneur != VM

"Separation of concerns": 1 "t√¢che" par conteneur

image::vm-and-container.png[]

[.notes]
--
Les hyperviseurs et les machines virtuelles (VM) sont comme des maisons enti√®rement meubl√©es o√π chaque invit√© a sa propre maison s√©par√©e.

* Chaque maison est une VM, avec son propre syst√®me d'exploitation et ses ressources, et elles peuvent fonctionner sur le m√™me serveur physique.
* En revanche, les conteneurs sont comme des appartements dans un m√™me immeuble. Ils partagent la m√™me infrastructure, comme les escaliers et les couloirs (le noyau du syst√®me d'exploitation), mais chaque appartement (conteneur) est s√©par√© et poss√®de son propre espace priv√©. Les conteneurs partagent efficacement les ressources du serveur, car ils √©vitent de dupliquer tout le syst√®me d'exploitation, ce qui les rend plus l√©gers et plus rapides que les VM.

En r√©sum√©, les VM sont comme des maisons s√©par√©es, tandis que les conteneurs sont comme des appartements dans le m√™me b√¢timent, partageant certaines parties communes mais offrant toujours une s√©paration.
--

==  VMs & Conteneurs

Non exclusifs mutuellement

image::cont-vm-not-excl.png[]

[.notes]
--
Les machines virtuelles (VM) et les conteneurs peuvent √™tre utilis√©s ensemble pour obtenir les avantages des deux mondes.

* Les VMs offrent une isolation plus forte en ex√©cutant des syst√®mes d'exploitation virtuels complets, ce qui les rend id√©ales pour des charges de travail n√©cessitant une s√©curit√© et une isolation √©lev√©es.
Les conteneurs, en revanche, sont l√©gers et rapides, ce qui les rend parfaits pour ex√©cuter de nombreuses applications sur un seul serveur.
* En combinant les deux, vous pouvez ex√©cuter des VMs pour isoler et prot√©ger des charges de travail sensibles, tout en utilisant des conteneurs pour ex√©cuter des applications l√©g√®res et faciles √† g√©rer.
Cela permet une flexibilit√© accrue dans la gestion des ressources et des charges de travail sur votre infrastructure informatique.
--

== üéì Exercice : Votre premier conteneur

C'est √† vous (ouf) !

* Retournez dans Gitpod
* Dans un terminal, tapez la commande suivante :

[source,bash]
----
docker container run hello-world
# Equivalent de l'ancienne commande 'docker run'
----

== ü©ª Anatomie

* Un service "Docker Engine" tourne en t√¢che de fond et publie une API REST
* La commande `docker run ...` a envoy√© une requ√™te `POST` au service
* Le service a t√©l√©charge une **Image** Docker depuis le registre **DockerHub**,
* Puis a ex√©cut√© un **conteneur** bas√© sur cette image

== üéì Exercice : O√π est mon conteneur ?

C'est √† vous !

[source,bash]
----
docker container ls --help
# ...
docker container ls
# ...
docker container ls --all
----

=> ü§î comment comprenez vous les r√©sultats des 2 derni√®res commandes ?

== ‚úÖ Solution : O√π est mon conteneur ?

Le conteneur est toujours pr√©sent dans le "Docker Engine" m√™me en √©tant arr√™t√©

[source,shell]
----
CONTAINER ID   IMAGE         COMMAND    CREATED          STATUS                      PORTS     NAMES
109a9cdd3ec8   hello-world   "/hello"   33 seconds ago   Exited (0) 17 seconds ago             festive_faraday
----

* Un conteneur == une commande "conteneuris√©e"
** cf. colonne "*COMMAND*"

* Quand la commande s'arr√™te : le conteneur s'arr√™te
** cf. code de sortie dans la colonne "*STATUS*"

== üéì Exercice : Cycle de vie d'un conteneur simple

* Lancez un nouveau conteneur nomm√© `bonjour`
** üí° `docker container run --help` ou https://docs.docker.com/engine/reference/commandline/container_run/[Documentation en ligne,window="_blank"]

* Affichez les "logs" du conteneur (==traces d'ex√©cution √©crites sur le stdout + stderr de la commande conteneuris√©e)
** üí° `docker container logs  --help` ou https://docs.docker.com/engine/reference/commandline/container_logs/[Documentation en ligne,window="_blank"]

* Lancez le conteneur avec la commande https://docs.docker.com/engine/reference/commandline/container_start/[`docker container start`,window="_blank"]
** Regardez le r√©sultat dans les logs

* Supprimez le container avec la commande https://docs.docker.com/engine/reference/commandline/container_rm/[`docker container rm`,window="_blank"]

== ‚úÖ Solution : Cycle de vie d'un conteneur simple

[source,bash]
----
docker container run --name=bonjour hello-world
# Affiche le texte habituel

docker container logs bonjour
# Affiche le m√™me texte : pratique si on a ferm√© le terminal

docker container start bonjour
# N'affiche pas le texte mais l'identifiant unique du conteneur 'bonjour'

docker container logs bonjour
# Le texte est affich√© 2 fois !

docker container ls --all
# Le conteneur est pr√©sent
docker container rm bonjour
docker container ls --all
# Le conteneur n'est plus l√† : il a √©t√© supprim√© ainsi que ses logs

docker container logs bonjour
# Error: No such container: bonjour
----

== ü§î Que contient "hello-world" ?

* C'est une "image" de conteneur, c'est √† dire un mod√®le (template)
repr√©sentant une application auto-suffisante.
** On peut voir √ßa comme un "paquetage" autonome

* C'est un syst√®me de fichier complet:
** Il y a au moins une racine `/`
** Ne contient que ce qui est cens√© √™tre n√©cessaire (d√©pendances, librairies, binaires, etc.)

== Docker Hub

* https://hub.docker.com/ : C'est le registre d'images "par d√©faut"
** Exemple : Image officielle de https://hub.docker.com/_/ubuntu[conteneur "Ubuntu"]

* üéì Cherchez l'image `hello-world` pour en voir la page de documentation
** üí° pas besoin de cr√©er de compte pour √ßa

* Il existe d'autre "registres" en fonction des besoins (GitHub GHCR, Google GCR, etc.)

== üéì Exercice : conteneur interactif

* Quel distribution Linux est utilis√©e dans le terminal Gitpod ?
** üí° Regardez le fichier `/etc/os-release`

* Ex√©cutez un conteneur interactif bas√© sur `alpine:3.17` (une distribution Linux ultra-l√©g√®re) et regardez le contenu du fichier au m√™me emplacement
** üí° `docker container run --help`
** üí° Demandez un https://en.wikipedia.org/wiki/TTY[`tty`] √† Docker
** üí° Activez le mode interactif

* Ex√©cutez la m√™me commande dans un conteneur bas√© sur la m√™me image mais en *NON* interactif
** üí° Comment surcharger la commande par d√©faut ?

== ‚úÖ Solution : conteneur interactif

[source,bash]
----
$ cat /etc/os-release
# ... Ubuntu ....

$ docker container run --tty --interactive alpine:3.17
/ # cat /etc/os-release
# ... Alpine ...
# Notez que le "prompt" du terminal est diff√©rent DANS le conteneur
/ # exit
$ docker container ls --all

$ docker container run alpine:3.17 cat /etc/os-release
# ... Alpine ...
----

== üéì Exercice : conteneur en t√¢che de fond

* Ex√©cutez un conteneur, bas√© sur l'image `nginx` en t√¢che de fond ("Background"), nomm√© `webserver-1`
** üí° On parle de processus "d√©tach√©" (ou bien "d√©monis√©")
** ‚ö†Ô∏è Pensez bien √† `docker container ls`

* Regardez le contenu du fichier `/etc/os-release` dans ce conteneur
** üí° `docker container exec`

* Essayez d'arr√™ter, d√©marrer puis red√©marrer le conteneur
** ‚ö†Ô∏è Pensez bien √† `docker container ls` √† chaque fois
** üí° `stop`, `start`, `restart`

== ‚úÖ Solution : conteneur en t√¢che de fond

[source,bash]
----
docker container run --detach --name=webserver-1 nginx
# <ID du conteneur>

docker container ls
docker container ls --all

docker container exec webserver-1 cat /etc/os-release
# ... Debian ...

docker container stop webserver-1
docker container ls
docker container ls --all

docker container start webserver-1
docker container ls
docker container ls --all

docker container start webserver-1
docker container ls
----

== Checkpoint üéØ

* Docker essaye de r√©soudre le probl√®me de l'empaquetage le plus "portable" possible
** On n'en a pas encore vu les effets, √ßa arrive !

* Vous avez vu qu'un containeur permet d'ex√©cuter une commande dans un environnement "pr√©par√©"
** Catalogue d'images Docker par d√©faut : Le https://hub.docker.com[Docker Hub]

* Vous avez vu qu'on peut ex√©cuter des conteneurs selon 3 modes :
** "One shot"
** Interactif
** En t√¢che de fond

=> ü§î Mais comment ces images sont-elles fabriqu√©es ? Quelle confiance leur accorder ?

== !

image::Diapositive12.PNG[width=1280]

== !

image::Diapositive13.PNG[width=1280]

== !

image::Diapositive14.PNG[width=1280]

== !

image::Diapositive15.PNG[width=1280]

== !

image::Diapositive16.PNG[width=1280]
== !

image::Diapositive16.PNG[width=1280]

== !

image::Diapositive17.PNG[width=1280]

== !

image::Diapositive18.PNG[width=1280]

== !

image::Diapositive19.PNG[width=1280]

== !

image::Diapositive20.PNG[width=1280]

== !

image::Diapositive21.PNG[width=1280]

== !

image::Diapositive22.PNG[width=1280]

== !

image::Diapositive23.PNG[width=1280]

== !

image::Diapositive24.PNG[width=1280]

== !

image::Diapositive25.PNG[width=1280]

== !

image::Diapositive26.PNG[width=1280]

== !

image::Diapositive27.PNG[width=1280]

== !

image::Diapositive28.PNG[width=1280]

== !

image::Diapositive29.PNG[width=1280]

== !

image::Diapositive30.PNG[width=1280]

== !

image::Diapositive31.PNG[width=1280]

== !

image::Diapositive32.PNG[width=1280]

== !

image::Diapositive33.PNG[width=1280]

== !

image::Diapositive34.PNG[width=1280]

== !

image::Diapositive35.PNG[width=1280]

== !

image::Diapositive36.PNG[width=1280]

== !

image::Diapositive37.PNG[width=1280]

== !

image::Diapositive38.PNG[width=1280]

== !

image::Diapositive39.PNG[width=1280]

== !

image::Diapositive40.PNG[width=1280]

== !

image::Diapositive41.PNG[width=1280]

== !

image::Diapositive42.PNG[width=1280]

== !

image::Diapositive43.PNG[width=1280]

== !

image::Diapositive44.PNG[width=1280]

== !

image::Diapositive45.PNG[width=1280]

== !

image::Diapositive46.PNG[width=1280]

== !

image::Diapositive47.PNG[width=1280]

== !

image::Diapositive48.PNG[width=1280]

== !

image::Diapositive49.PNG[width=1280]

== !

image::Diapositive50.PNG[width=1280]

== !

image::Diapositive51.PNG[width=1280]

== !

image::Diapositive52.PNG[width=1280]

== !

image::Diapositive53.PNG[width=1280]

== !

image::Diapositive54.PNG[width=1280]

== !

image::Diapositive55.PNG[width=1280]

== !

image::Diapositive56.PNG[width=1280]

== !

image::Diapositive57.PNG[width=1280]

== !

image::Diapositive58.PNG[width=1280]

== !

image::Diapositive59.PNG[width=1280]

== !

image::Diapositive60.PNG[width=1280]

== !

image::Diapositive61.PNG[width=1280]

== !

image::Diapositive62.PNG[width=1280]

