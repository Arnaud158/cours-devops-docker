[{invert}]

= Docker

"La Base"

== Pourquoi ?

image::docker-logo-monochromatic.png[width=200]

🤔 Quel est le problème ?

[%auto-animate]
== Pourquoi commencer par un problème ?

image::docker-logo-monochromatic.png[width=200]

🤔 Commençons plutôt par une définition:

> Docker c'est ...

[.notes]
--
* Demander à l'assistance une définition
--

[%auto-animate]
== Pourquoi commencer par un problème ?

image::docker-logo-monochromatic.png[width=200]

🤔 Définition quelque peu datée (2014):

> Docker is ...

[.notes]
--
* Demander à l'assistance une définition
* make a point
--

[%auto-animate]
== Pourquoi commencer par un problème ?

image::docker-logo-monochromatic.png[width=200]

🤔 Définition quelque peu datée (2014):

> Docker is a toolset for Linux containers designed to ‘build, ship and run’ distributed applications.

[.small]
https://www.infoq.com/articles/docker-future/

[.notes]
--
* https://www.infoq.com/articles/docker-future/
--

[%auto-animate]
== Linux containers ?

image::docker-logo-monochromatic.png[width=200]

🤔 Nous voilà bien...

> C'est quoi un container?

[.notes]
--
* https://www.infoq.com/articles/docker-future/
--

[%auto-animate]
== Linux containers ?

image::docker-logo-monochromatic.png[width=200]

🤔 Nous voilà bien...

> C'est quoi un container?

[.small]
Vous voulez la version enfant de 5 ans? Je ne crois pas...

[.notes]
--
* J'ai la version "les containers expliqués à un enfant de 5 ans", mais pas sûr que vous appréciez...
* On va donc passer à la suite, et on y revient dans un moment.
* Imagine que tu as une boîte magique appelée "conteneur".
* Cette boîte peut contenir toutes sortes de choses, comme des jouets, des bonbons ou même des dessins.
* Maintenant, dans le monde de l'informatique, un conteneur Docker est un peu comme cette boîte magique.
* Mais au lieu de jouets ou de bonbons, un conteneur Docker peut contenir des programmes et toutes les choses dont ces programmes ont besoin pour fonctionner.
* Par exemple, il peut contenir un site Web, une application ou même une partie d'un jeu vidéo.
* Ce qui est vraiment cool avec les conteneurs Docker, c'est qu'ils sont très spéciaux.
* Chaque conteneur est comme une petite boîte magique qui garde tout bien organisé à l'intérieur.
* Et tu peux facilement prendre cette boîte magique et la mettre sur n'importe quel ordinateur, qu'il soit grand ou petit, comme si tu transportais tes jouets préférés chez un ami.
* Cela signifie que les conteneurs Docker aident les développeurs à s'assurer que leurs programmes fonctionnent de la même manière partout où ils les utilisent. C'est comme si tu pouvais t'amuser avec tes jouets préférés chez toi, chez un ami, ou même à l'école, et tout fonctionnerait toujours comme prévu.
* En résumé, un conteneur Docker est comme une boîte magique pour les programmes informatiques.
* Il garde tout bien organisé à l'intérieur et peut être déplacé facilement d'un ordinateur à un autre, comme si tu emportais tes jouets préférés partout où tu vas. C'est super pratique pour les personnes qui créent des choses sur l'ordinateur !
--

[{invert}]
[.columns]
== Docker est vieux

[.column]
--
image::containerconteneuraccidenteavariejpg_5e8b87ccc8c27.jpg[position=left, opacity=0.1]
--

[.column]
--
10 ans déjà...
--

[.notes]
--
* The story of Docker starts in Paris with a startup called DotCloud, founded by Solomon Hykes, Kamel Founadi,
and Sebastien Pahl in 2008 to provide cloud hosting services for software developers.
* It was first released as an open source project by DotCloud in March 2013.
* The project quickly became popular, leading to DotCloud rebranded as Docker Inc
--

== On n'avait pas parlé d'un problème?

image::matrixfromhell.jpg[]

Problème de temps **exponentiel**

[.notes]
--
* Le "problème de la matrice de l'enfer" (ou "matrix from hell" en anglais) est une expression qui fait référence à la complexité croissante des configurations logicielles dans le monde de l'informatique.
* Avant l'arrivée de Docker, il était souvent difficile de gérer toutes les dépendances et les paramètres nécessaires pour exécuter des applications sur différents ordinateurs.
* Docker tente de résoudre ce problème en introduisant la notion de conteneurs.
* Les conteneurs Docker sont des environnements autonomes qui contiennent une application et toutes ses dépendances, y compris les bibliothèques et les paramètres. Cela signifie que les développeurs peuvent créer un conteneur qui fonctionne parfaitement sur leur propre ordinateur, puis le partager avec d'autres sans se soucier des différences entre les environnements.
* En résumé, Docker résout le "problème de la matrice de l'enfer" en permettant aux développeurs de créer des conteneurs contenant leurs applications, ce qui garantit que celles-ci fonctionneront de la même manière partout, évitant ainsi les tracas liés aux configurations complexes.
--

== Déjà vu ?

L'IT n'est pas la seule industrie à résoudre des problèmes...

image::also-a-matrix-from-hell.png[]

== Solution: Le conteneur intermodal

"Separation of Concerns"

image::blue-shipping-container.png[]

[.notes]
--
Faire le parallèle avec les containers marchands contenant des jouets, de l'électronique, de la nourriture, le tout connecté au même bateau, sans pour autant être interdépendants.
Docker apporte une séparation claire des préoccupations grâce à ses conteneurs. Cette séparation des préoccupations signifie que chaque composant d'une application est isolé dans son propre conteneur. Voici comment cela fonctionne :

1. Isolation des Composants : Avec Docker, chaque composant d'une application (comme une base de données, un serveur web, etc.) est emballé dans un conteneur distinct. Ces conteneurs fonctionnent de manière indépendante les uns des autres, ce qui signifie que si un composant rencontre un problème ou nécessite une mise à jour, cela n'affecte pas les autres composants.
2. Portabilité : Les conteneurs Docker encapsulent non seulement l'application, mais aussi toutes ses dépendances. Cela garantit que l'application fonctionnera de la même manière quel que soit l'endroit où vous l'exécutez, que ce soit sur votre ordinateur local, un serveur en nuage ou ailleurs. Cela simplifie la gestion de l'application à l'échelle.
3. Facilité de Déploiement : En raison de cette séparation, le déploiement d'applications devient plus simple. Vous pouvez gérer chaque conteneur individuellement, les mettre à jour sans perturber le reste de l'application, et même les répliquer pour mettre en place des configurations complexes.
4. Gestion des Ressources : Docker permet également de gérer efficacement les ressources de l'ordinateur hôte. Chaque conteneur a sa propre allocation de ressources, ce qui empêche un conteneur de monopoliser toute la puissance de calcul, garantissant ainsi des performances stables pour toutes les parties de l'application.

En résumé, Docker apporte une séparation des préoccupations claire en isolant chaque composant d'une application dans son propre conteneur. Cela facilite le déploiement, la gestion et la maintenance des applications, tout en garantissant la portabilité et la stabilité des performances.
--

== Comment ça marche ?

"Virtualisation **Légère**"

image::container_vs_vm.jpg[]

== Conteneur != VM

"Separation of concerns": 1 "tâche" par conteneur

image::vm-and-container.png[]

==  VMs && Conteneurs

Non exclusifs mutuellement

image::cont-vm-not-excl.png[]

== Comment ça marche ?

== 🎓 Exercice : Votre premier conteneur

C'est à vous (ouf) !

* Retournez dans Gitpod
* Dans un terminal, tapez la commande suivante :

[source,bash]
----
docker container run hello-world
# Equivalent de l'ancienne commande 'docker run'
----

== 🩻 Anatomie

* Un service "Docker Engine" tourne en tâche de fond et publie une API REST
* La commande `docker run ...` a envoyé une requête `POST` au service
* Le service a télécharge une **Image** Docker depuis le registre **DockerHub**,
* Puis a exécuté un **conteneur** basé sur cette image

== 🎓 Exercice : Où est mon conteneur ?

C'est à vous !

[source,bash]
----
docker container ls --help
# ...
docker container ls
# ...
docker container ls --all
----

=> 🤔 comment comprenez vous les résultats des 2 dernières commandes ?

== ✅ Solution : Où est mon conteneur ?

Le conteneur est toujours présent dans le "Docker Engine" même en étant arrêté

[source,shell]
----
CONTAINER ID   IMAGE         COMMAND    CREATED          STATUS                      PORTS     NAMES
109a9cdd3ec8   hello-world   "/hello"   33 seconds ago   Exited (0) 17 seconds ago             festive_faraday
----

* Un conteneur == une commande "conteneurisée"
** cf. colonne "*COMMAND*"

* Quand la commande s'arrête : le conteneur s'arrête
** cf. code de sortie dans la colonne "*STATUS*"

== 🎓 Exercice : Cycle de vie d'un conteneur simple

* Lancez un nouveau conteneur nommé `bonjour`
** 💡 `docker container run --help` ou https://docs.docker.com/engine/reference/commandline/container_run/[Documentation en ligne,window="_blank"]

* Affichez les "logs" du conteneur (==traces d'exécution écrites sur le stdout + stderr de la commande conteneurisée)
** 💡 `docker container logs  --help` ou https://docs.docker.com/engine/reference/commandline/container_logs/[Documentation en ligne,window="_blank"]

* Lancez le conteneur avec la commande https://docs.docker.com/engine/reference/commandline/container_start/[`docker container start`,window="_blank"]
** Regardez le résultat dans les logs

* Supprimez le container avec la commande https://docs.docker.com/engine/reference/commandline/container_rm/[`docker container rm`,window="_blank"]

== ✅ Solution : Cycle de vie d'un conteneur simple

[source,bash]
----
docker container run --name=bonjour hello-world
# Affiche le texte habituel

docker container logs bonjour
# Affiche le même texte : pratique si on a fermé le terminal

docker container start bonjour
# N'affiche pas le texte mais l'identifiant unique du conteneur 'bonjour'

docker container logs bonjour
# Le texte est affiché 2 fois !

docker container ls --all
# Le conteneur est présent
docker container rm bonjour
docker container ls --all
# Le conteneur n'est plus là : il a été supprimé ainsi que ses logs

docker container logs bonjour
# Error: No such container: bonjour
----

== 🤔 Que contient "hello-world" ?

* C'est une "image" de conteneur, c'est à dire un modèle (template)
représentant une application auto-suffisante.
** On peut voir ça comme un "paquetage" autonome

* C'est un système de fichier complet:
** Il y a au moins une racine `/`
** Ne contient que ce qui est censé être nécessaire (dépendances, librairies, binaires, etc.)

== Docker Hub

* https://hub.docker.com/ : C'est le registre d'images "par défaut"
** Exemple : Image officielle de https://hub.docker.com/_/ubuntu[conteneur "Ubuntu"]

* 🎓 Cherchez l'image `hello-world` pour en voir la page de documentation
** 💡 pas besoin de créer de compte pour ça

* Il existe d'autre "registres" en fonction des besoins (GitHub GHCR, Google GCR, etc.)

== 🎓 Exercice : conteneur interactif

* Quel distribution Linux est utilisée dans le terminal Gitpod ?
** 💡 Regardez le fichier `/etc/os-release`

* Exécutez un conteneur interactif basé sur `alpine:3.17` (une distribution Linux ultra-légère) et regardez le contenu du fichier au même emplacement
** 💡 `docker container run --help`
** 💡 Demandez un https://en.wikipedia.org/wiki/TTY[`tty`] à Docker
** 💡 Activez le mode interactif

* Exécutez la même commande dans un conteneur basé sur la même image mais en *NON* interactif
** 💡 Comment surcharger la commande par défaut ?

== ✅ Solution : conteneur interactif

[source,bash]
----
$ cat /etc/os-release
# ... Ubuntu ....

$ docker container run --tty --interactive alpine:3.17
/ # cat /etc/os-release
# ... Alpine ...
# Notez que le "prompt" du terminal est différent DANS le conteneur
/ # exit
$ docker container ls --all

$ docker container run alpine:3.17 cat /etc/os-release
# ... Alpine ...
----

== 🎓 Exercice : conteneur en tâche de fond

* Exécutez un conteneur, basé sur l'image `nginx` en tâche de fond ("Background"), nommé `webserver-1`
** 💡 On parle de processus "détaché" (ou bien "démonisé")
** ⚠️ Pensez bien à `docker container ls`

* Regardez le contenu du fichier `/etc/os-release` dans ce conteneur
** 💡 `docker container exec`

* Essayez d'arrêter, démarrer puis redémarrer le conteneur
** ⚠️ Pensez bien à `docker container ls` à chaque fois
** 💡 `stop`, `start`, `restart`

== ✅ Solution : conteneur en tâche de fond

[source,bash]
----
docker container run --detach --name=webserver-1 nginx
# <ID du conteneur>

docker container ls
docker container ls --all

docker container exec webserver-1 cat /etc/os-release
# ... Debian ...

docker container stop webserver-1
docker container ls
docker container ls --all

docker container start webserver-1
docker container ls
docker container ls --all

docker container start webserver-1
docker container ls
----

== Checkpoint 🎯

* Docker essaye de résoudre le problème de l'empaquetage le plus "portable" possible
** On n'en a pas encore vu les effets, ça arrive !

* Vous avez vu qu'un containeur permet d'exécuter une commande dans un environnement "préparé"
** Catalogue d'images Docker par défaut : Le https://hub.docker.com[Docker Hub]

* Vous avez vu qu'on peut exécuter des conteneurs selon 3 modes :
** "One shot"
** Interactif
** En tâche de fond

=> 🤔 Mais comment ces images sont-elles fabriquées ? Quelle confiance leur accorder ?

== !

image::Diapositive12.PNG[width=1280]

== !

image::Diapositive13.PNG[width=1280]

== !

image::Diapositive14.PNG[width=1280]

== !

image::Diapositive15.PNG[width=1280]

== !

image::Diapositive16.PNG[width=1280]
== !

image::Diapositive16.PNG[width=1280]

== !

image::Diapositive17.PNG[width=1280]

== !

image::Diapositive18.PNG[width=1280]

== !

image::Diapositive19.PNG[width=1280]

== !

image::Diapositive20.PNG[width=1280]

== !

image::Diapositive21.PNG[width=1280]

== !

image::Diapositive22.PNG[width=1280]

== !

image::Diapositive23.PNG[width=1280]

== !

image::Diapositive24.PNG[width=1280]

== !

image::Diapositive25.PNG[width=1280]

== !

image::Diapositive26.PNG[width=1280]

== !

image::Diapositive27.PNG[width=1280]

== !

image::Diapositive28.PNG[width=1280]

== !

image::Diapositive29.PNG[width=1280]

== !

image::Diapositive30.PNG[width=1280]

== !

image::Diapositive31.PNG[width=1280]

== !

image::Diapositive32.PNG[width=1280]

== !

image::Diapositive33.PNG[width=1280]

== !

image::Diapositive34.PNG[width=1280]

== !

image::Diapositive35.PNG[width=1280]

== !

image::Diapositive36.PNG[width=1280]

== !

image::Diapositive37.PNG[width=1280]

== !

image::Diapositive38.PNG[width=1280]

== !

image::Diapositive39.PNG[width=1280]

== !

image::Diapositive40.PNG[width=1280]

== !

image::Diapositive41.PNG[width=1280]

== !

image::Diapositive42.PNG[width=1280]

== !

image::Diapositive43.PNG[width=1280]

== !

image::Diapositive44.PNG[width=1280]

== !

image::Diapositive45.PNG[width=1280]

== !

image::Diapositive46.PNG[width=1280]

== !

image::Diapositive47.PNG[width=1280]

== !

image::Diapositive48.PNG[width=1280]

== !

image::Diapositive49.PNG[width=1280]

== !

image::Diapositive50.PNG[width=1280]

== !

image::Diapositive51.PNG[width=1280]

== !

image::Diapositive52.PNG[width=1280]

== !

image::Diapositive53.PNG[width=1280]

== !

image::Diapositive54.PNG[width=1280]

== !

image::Diapositive55.PNG[width=1280]

== !

image::Diapositive56.PNG[width=1280]

== !

image::Diapositive57.PNG[width=1280]

== !

image::Diapositive58.PNG[width=1280]

== !

image::Diapositive59.PNG[width=1280]

== !

image::Diapositive60.PNG[width=1280]

== !

image::Diapositive61.PNG[width=1280]

== !

image::Diapositive62.PNG[width=1280]

